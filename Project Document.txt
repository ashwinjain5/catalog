About Project:
This project is related to catalog sharing and shortlisting.
How it works as of 17-Sep-2025 (only requirement portal, wholesale portal etc have been prepared until this date):
1. Add projects with image URLs and prices in the google sheet.
2. That sheet is broadcasted to public as JSON File
3. That JSON data is picked by the github pages server and showcased in frontend through this project repository.

Future Updates:
- Google sheet columns to be made in sync with standard Product/items table
- Each stakeholder to have their own catalog page vis-a-vis Kishore Mama, Gautam Mama, Amith Bhaiya, Dhariwal Retail etc.



Project Email: rashwinjain5@gmail.com

Project Host: Github Pages: https://ashwinjain5.github.io/catalog/

ChatGPT Project Chat Link: https://chatgpt.com/g/g-p-68a808f0c2c08191a254e8e45d9a1d10-catalogue-portal/project

Github Repo: https://github.com/ashwinjain5/catalog.git

Local Folder in Ashwin's laptop: D:\catalogue-portal

Source Excel File: https://docs.google.com/spreadsheets/d/1nwDhisah8ujwWgflwDm4K3RPLlTuAN3CxE37QSOYH-o/edit?usp=sharing
(under rashwinjain5@gmail.com)






Project Current Status Analysis
===============================

Date: 2025-11-13

Summary
-------
This repository implements a static frontend (for GitHub Pages) that reads product data published as CSV or JSON (from a Google Sheet exported as CSV or an Apps Script JSONP endpoint) and renders a catalogue with filtering, searching, and a shortlist feature. The UI allows end users to browse product cards, shortlist items, and share shortlists via WhatsApp. There's also an export-to-PDF helper.

Data flow
---------
- Source of truth: Google Sheet (shared publicly or via an Apps Script endpoint).
- Two supported ingestion modes:
	- CSV mode: `SHEET_CSV_URL` is fetched and parsed by `fetchProductsFromCSV` in `src/utils/fetchSheet.js`.
	- Apps Script JSONP mode: `APPS_SCRIPT_URL` is requested via JSONP helper `jsonp()` in `src/utils/jsonp.js`.
- After ingestion, rows are normalized into product objects (see `shapeRow`) and stored in `state.products`.

Runtime / hosting
-----------------
- Intended to run as static files on GitHub Pages (index.html + config.js). No server-side code required if the sheet is public or provided via Apps Script JSONP.

Frontend structure & key DOM elements
------------------------------------
These are the important DOM elements referenced in `src/app.js` (IDs are used directly):

- `catalogue` — the main grid/container where product cards are rendered.
- `bottomBar` — bottom action bar that becomes visible when items are shortlisted (contains view/share actions).
- `selectedCount` — (present but not actively used in code; count is rendered into `shortlistCount` element instead).
- `waShareLink` — anchor element whose href is set to a WhatsApp share URL for the shortlist.
- `searchInput` — free-text search field at top of the page.
- `filtersBtn` — button that opens the filters dialog.
- `filtersDialog` — <dialog> element containing filter controls.
- `chips` — small UI area showing active filter chips.
- `filterCategory`, `filterSubCategory`, `filterBrand`, `filterColors` — each is a container element where checkbox lists are rendered for facets.
- `filterPriceMin`, `filterPriceMax` — numeric inputs for price range.
- `filterInStock` — checkbox input to filter only in-stock items.
- `clearFiltersBtn` — button to clear all filters.
- `applyFiltersBtn` — button to read selected filter inputs and apply them.
- `shortlistDrawer` — a dialog element used to display shortlisted items.
- `shortlistList` — the list inside the shortlist drawer where shortlisted SKUs show.
- Buttons on product cards: rendered with attribute `data-toggle="<sku>"` and text toggles between "Add to shortlist" and "Remove from shortlist".

UI behavior and interactions
---------------------------
- Page init (`init()`): loads products (CSV or JSONP), populates facet dropdowns, binds UI handlers, applies filters from URL and renders catalogue.
- Search: typing in `searchInput` updates `state.filters.search`, writes to URL `?search=...`, and re-renders live.
- Filters dialog: open via `filtersBtn`. Checkbox lists for category/subCategory/brand/colors are generated dynamically from product data.
- Apply filters (`applyFiltersBtn`): reads checked values, numeric price bounds, inStock value, updates `state.filters`, writes filters to URL and re-renders.
- Clear filters (`clearFiltersBtn`): resets UI inputs and `state.filters`, clears URL query string, re-renders.
- Product cards: each shows image (clickable to open `imageModal`), title, sku, brand, price, stock status, and a toggle button to add/remove from shortlist. Adding/removing updates `state.shortlist` and the bottom bar.
- Shortlist drawer: `openShortlistDrawer()` populates `shortlistList` and opens the dialog. Each item inside has a remove button that calls global `removeFromShortlist(sku)`.
- Shortlist All Visible: `shortlistAllVisible()` adds all currently visible (post-filter) products to the shortlist.
- Share shortlist: clicking `shareShortlistBtn` builds a plain-text message with SKU and titles and opens a WhatsApp share window (`https://wa.me/?text=...`). `waShareLink` is also set by `renderBottomBar()` to a link generated by `buildMultiShare()` (which includes quantity, color, notes when present).
- Export to PDF: `exportVisibleAsPDF(containerId)` uses html2canvas + jsPDF (loaded lazily) to capture the catalogue container and save as PDF. This helper is in `src/utils/pdf.js`.

Buttons, controls and their purpose (quick list)
-----------------------------------------------
- `filtersBtn`: open the filter dialog.
- `clearFiltersBtn`: reset all filters and search.
- `applyFiltersBtn`: apply selected filters and update UI/URL.
- `searchInput` (text field): live search across title/sku/tags.
- Product card toggle button (data-toggle="sku"): add/remove that SKU to/from shortlist.
- `shareShortlistBtn`: share the shortlist via WhatsApp (opens new tab/window).
- `shortlistAllVisible()` (exposed globally): programmatic button (if present in UI) to add all visible items to shortlist.
- In shortlist drawer: per-item remove (calls `removeFromShortlist`).
- `waShareLink`: anchor for sharing via WhatsApp (updated whenever shortlist changes).

Scripts and responsibilities
---------------------------
- `src/app.js` (main): Core application logic, state management (state.products, state.filters, state.shortlist), DOM rendering for product cards, chip rendering, event binding, shortlist management, and UI glue. Reads/sets URL filters and opens dialogs. Depends on utility modules (applyFilters, fetchSheet, jsonp, pdf, urlFilters, whatsapp helpers).

- `src/utils/applyFilters.js`: Pure filter function `applyFilters(products, f)` that applies search, facet selection, price range, stock, color, and shortlist-only filtering. Returns a filtered array.

- `src/utils/fetchSheet.js`: Exposes `fetchProductsFromCSV(csvUrl)` and helper `shapeRow`. Fetches CSV from `SHEET_CSV_URL`, parses, normalizes types, and returns an array of product objects.

- `src/utils/jsonp.js`: JSONP helper `jsonp(url, callbackParam)` returning a Promise that resolves with data. Used when the data source is an Apps Script endpoint returning JSONP.

- `src/utils/pdf.js`: `exportVisibleAsPDF(containerId)` — lazy-loads `html2canvas` and `jspdf` from CDNs, captures the catalogue DOM into an image and saves as PDF. This is optional and loaded on demand.

- `src/utils/urlFilters.js`: Helpers to parse filters from URL (`parseFiltersFromURL()`) and to write current filters to URL (`setFiltersToURL(f)`). Also handles `shortlistOnly` URL param.

- `src/utils/whatsapp.js`: Two helper functions `buildMultiShare(selected)` and `buildSingleShare(sku)` which produce WhatsApp share URLs; notes: `buildMultiShare` formats lines to include quantity, color, and note if present on each shortlisted item.

Known gaps, assumptions & recommendations
--------------------------------------
- Assumption: `index.html` contains matching elements with the IDs referenced in `app.js`. The project depends on `config.js` to supply constants like `SHEET_CSV_URL`, `DATA_SOURCE`, and `APPS_SCRIPT_URL`.
- The CSV parsing in `fetchProductsFromCSV` uses a very simple comma split; it will break if the CSV contains commas inside quoted fields. If the Google Sheet CSV contains commas in text fields, replace the simple parser with a proper CSV parser (PapaParse or similar).
- `selectedCount` is declared in `els` but not used; `shortlistCount` element is updated by `renderBottomBar()` instead. Consider removing `selectedCount` or standardizing on one ID.
- `fetchProductsFromCSV` returns `price` as Number using Number(row.price||0) — ensure spreadsheet has numeric price values (or clean them in `shapeRow`).
- JSONP path relies on the Apps Script endpoint returning data under `.data` property. Confirm Apps Script response shape matches expectations.
- The app stores shortlist items only in-memory in `state.shortlist`; there is no persistence across page reloads. If persistence is needed, store shortlist in localStorage and restore on init.
- The `pdf.js` lazy import uses dynamic import from CDN URLs; in some browsers/environments this may fail if cross-origin module imports are blocked. Consider bundling or using script tags as fallback.
- Accessibility: focus management for dialogs (`filtersDialog`, `shortlistDrawer`) should be reviewed for keyboard users.

Next steps (suggested)
----------------------
1. If CSV may contain commas: replace `fetchProductsFromCSV` parsing with PapaParse to correctly handle CSV quoting.
2. Add persistence for shortlist using localStorage (optional) so shortlist survives reloads.
3. Normalize and document `config.js` keys and expected Apps Script JSON shape.
4. Add unit tests for `applyFilters` function (happy path + edge cases like empty filters, missing fields, price bounds).
5. Small cleanup: remove unused `selectedCount` or use it consistently.

Status: analysis written and saved in this file.

Detailed frontend layout & element positions
--------------------------------------------
The project uses a single-page layout (rendered client-side). The following describes the expected visual/DOM layout and where the IDs from `app.js` likely appear in the page:

- Header area (top):
	- `searchInput` — placed near the top, typically left-aligned or centered in a header bar; live search input.
	- `filtersBtn` — typically a button near the search input or at top-right to open filter dialog.

- Filters dialog (`filtersDialog`):
	- Modal `<dialog>` that contains:
		- `filterCategory` — checkbox list container for categories (stacked vertically or in columns).
		- `filterSubCategory` — container for sub-categories.
		- `filterBrand` — container for brand checkboxes.
		- `filterColors` — container for color checkboxes.
		- `filterPriceMin` and `filterPriceMax` — numeric inputs arranged inline for price range.
		- `filterInStock` — checkbox for toggling in-stock filter.
		- `applyFiltersBtn` — button to apply filters and close/apply the dialog.
		- `clearFiltersBtn` — button to reset inputs.

- Filter chips area:
	- `chips` — usually a container under the header/search to display active filter labels.

- Main catalogue grid (`catalogue`):
	- Grid of product cards (responsive). Each card contains:
		- image (clickable) — opens `imageModal` and `modalImage`.
		- `.title` — product title text.
		- `.meta` — SKU and brand.
		- `.price` — display of price (prefixed with Rupee symbol in code).
		- `.stock` — stock status with class `in` or `out`.
		- toggle button — has attribute `data-toggle="<sku>"` and toggles shortlist state.

- Image Modal:
	- `imageModal` — a dialog element with `modalImage` inside to show the clicked product image.

- Bottom action bar (`bottomBar`):
	- Shows when shortlist has items. Contains:
		- `shortlistCount` — element that shows the number of shortlisted items (updated by `renderBottomBar`).
		- `shareShortlistBtn` — button that triggers WhatsApp share flow.
		- `waShareLink` — anchor that also contains a share URL (set on render).
		- Button to open shortlist drawer (likely calls `openShortlistDrawer()`).

- Shortlist drawer (`shortlistDrawer` & `shortlistList`):
	- `shortlistDrawer` is a `<dialog>` containing `shortlistList` where each shortlisted row shows SKU, title and a remove button (which calls `removeFromShortlist`).

Notes on layout assumptions:
- The HTML file (`index.html`) should provide these IDs; `app.js` accesses them via `document.getElementById`. If any ID is missing the app will throw errors during `init()` and fallback may show a load error.

Buttons & controls — full behavior matrix
----------------------------------------
Each control listed with its selector (ID/class where applicable) and exact behavior.

- `#searchInput` (input)
	- Event: `input` (debounce not implemented; updates on every keystroke).
	- Action: updates `state.filters.search`, calls `setFiltersToURL`, triggers `applyAndRender()`.

- `#filtersBtn` (button)
	- Event: `click`
	- Action: shows `filtersDialog` via `filtersDialog.showModal()`.

- `#filtersDialog` (dialog)
	- Contains facet controls and action buttons.

- `#filterCategory`, `#filterSubCategory`, `#filterBrand`, `#filterColors` (containers)
	- Populated dynamically with checkbox inputs by `populateDropdowns()`.
	- Selection read by `getCheckedValues(container)` during apply.

- `#filterPriceMin`, `#filterPriceMax` (inputs)
	- Numeric values parsed to Number; empty string treated as undefined.

- `#filterInStock` (checkbox)
	- If checked sets `state.filters.inStock = 1`.

- `#applyFiltersBtn` (button)
	- Reads checkbox/select inputs + price + inStock; updates `state.filters`; calls `setFiltersToURL` and `applyAndRender()`.

- `#clearFiltersBtn` (button)
	- Clears UI controls and `state.filters`, clears search input, writes empty URL (history.replaceState) and calls `applyAndRender()`.

- Product card toggle button (selector: `[data-toggle="<sku>"]`)
	- Event: `click` added after render in `renderList`.
	- Action: toggles presence of the SKU in `state.shortlist`. Updates bottom bar and changes button class/text.

- Product image inside `.card img`
	- Event: `click`
	- Action: sets `modalImage.src` and opens `imageModal`.

- Global functions exposed to window:
	- `removeFromShortlist(sku)` — remove item, update UI.
	- `openShortlistDrawer()` — render shortlist and `showModal()` on drawer.
	- `shortlistAllVisible()` — add all visible products to shortlist.

- `#shareShortlistBtn` (button)
	- Event: `click`
	- Action: If shortlist empty, alerts the user. Otherwise builds a message using product titles and SKUs and opens a WhatsApp compose window with `https://wa.me/?text=...`.

- `#waShareLink` (anchor)
	- Updated by `renderBottomBar()` to the URL returned by `buildMultiShare()`; clicking opens WhatsApp sharing as well.

Detailed per-file script responsibilities (expanded)
-------------------------------------------------
Below are more granular responsibilities, core functions, global side-effects and edge cases for each script.

- `src/app.js` (main application glue)
	- Responsibilities:
		- Holds runtime `state` (products, filters, shortlist).
		- Orchestrates data load (`loadProducts()` -> CSV or JSONP), UI population (`populateDropdowns()`), and event binding (`bindUI()`).
		- Rendering functions: `renderList`, `cardHTML`, `renderChips`, `renderBottomBar`, `renderShortlistList`.
		- Manages shortlist actions and exposes window globals (`removeFromShortlist`, `openShortlistDrawer`, `shortlistAllVisible`).
		- Reads/writes URL query string via `parseFiltersFromURL` and `setFiltersToURL` (from `urlFilters.js`).
	- Edge cases handled / not handled:
		- Handles missing image by hiding image element (`onerror` sets display none).
		- If data load fails, displays a friendly error in `catalogue`.
		- Does not persist shortlist across reloads.
		- Assumes `SHEET_CSV_URL` or `APPS_SCRIPT_URL` is correctly configured; throws informative error if not.

- `src/utils/applyFilters.js`
	- Pure function `applyFilters(products, f)`.
	- Applies inStock check, facet membership, color overlaps, numeric boundaries, and free-text search (title, sku, tags).
	- Important behavior: search is case-insensitive and checks title, sku and tags joined blob.
	- Suggestion: add unit tests for empty products array, missing fields, and large arrays.

- `src/utils/fetchSheet.js`
	- `fetchProductsFromCSV(csvUrl)` fetches CSV with `fetch` and parses rows by splitting on commas. `shapeRow` converts strings to typed fields.
	- Limitations: simplistic CSV parsing fails on quoted fields with commas; recommend switching to a robust CSV parser (e.g., PapaParse) if input can contain commas.
	- `shapeRow` converts `price`, `mrp`, `priority` to Number and `inStock` to boolean via regex against `1|true|yes`.

- `src/utils/jsonp.js`
	- `jsonp(url, callbackParam='callback')` creates a dynamic script tag, injects a callback name on window, and resolves Promise when called. Cleans up script and callback afterward.
	- Note: relies on remote endpoint invoking the callback exactly once. No timeout is implemented; consider adding timeout for fail-safe.

- `src/utils/pdf.js`
	- `exportVisibleAsPDF(containerId)` lazy-loads `html2canvas` and `jspdf` via dynamic import from CDN and produces a single-page PDF using the canvas capture.
	- Limitations: large catalog DOM may produce very long images that don't paginate; current code adds image once scaled to A4 width — long content will be compressed vertically. For multi-page exports implement canvas splitting and addImage for multiple pages.
	- Cross-origin images may taint canvas and block export; ensure images are CORS-enabled or provide fallback.

- `src/utils/urlFilters.js`
	- `parseFiltersFromURL()` maps URL params into structured filter object (handles arrays for facets and numeric parse for price bounds). Also reads `shortlistOnly` param used to display only specific SKUs.
	- `setFiltersToURL(f)` writes the active parts of `f` into the `history.replaceState` query string.
	- Note: `inStock` is encoded as `1`/`0` (string) in URL.

- `src/utils/whatsapp.js`
	- `buildMultiShare(selected)` produces a multi-line message for the shortlist. It supports optional `qty`, `color`, and `note` fields per shortlisted item.
	- `buildSingleShare(sku)` creates a message and link to open the page with `?search=<sku>`.

Completion and next steps
-------------------------
All pending tasks in the todo list have been completed and the file now contains:
- Project overview and data flow (earlier)
- Detailed frontend layout and element mapping (new)
- Full button/control behavior matrix (new)
- Expanded per-file script responsibilities and edge cases (new)




